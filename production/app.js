function runGame(){function e(e){var t=e.clientX,n=e.clientY,s=transIndex2to1([Math.floor(t/o.tsize),Math.floor(n/o.tsize)],o);console.log(o.tiles[s]),e.ctrlKey?i.shoot(i.keepers[0],[t,n]):(0!=o.tiles[s].object.length&&a.select(o.tiles[s].object[0]),a.selected&&"Mage"==a.selected.name&&(a.selected.waypoints.push(s),2==a.selected.waypoints.length&&(a.selected.path=findPath(o,a.selected.waypoints[0],a.selected.waypoints[1]),a.selected.path.shift(),a.selected.waypoints.shift())))}function t(){0==o.tiles[d].object.length&&0==o.tiles[d+1].object.length&&Math.random()<.01&&i.spawnObject(Enemy),s.clearRect(0,0,n.width,n.height),o.render(),i.processShooters(),i.moveAll(),i.renderAll(),a.render(),requestAnimationFrame(t)}var n=document.getElementById("game"),s=n.getContext("2d");n.width=window.innerWidth,n.height=window.innerHeight;var o=new Tilemap(n,s);o.populate();var i=new ObjectsManager(s,o),a=new UI(o,s),r=[0,Math.floor(o.rows/2)*o.tsize],l=[1*o.tsize,(Math.floor(o.rows/2)-1)*o.tsize],c=[(o.cols-4)*o.tsize,Math.floor(o.rows/2)*o.tsize],d=(transIndex2to1([c[0]/o.tsize,c[1]/o.tsize],o),transIndex2to1([r[0]/o.tsize,r[1]/o.tsize],o));i.spawnObject(Mage,l),i.spawnObject(Orb,c),i.createStones(),i.createMenhirs(),i.sortObjects(),n.addEventListener("mousedown",e,!1),t()}document.addEventListener("DOMContentLoaded",function(){runGame()});